{"version":3,"file":"use-router.js","sources":["src/use-router/location.js","src/use-router/parse.js","src/use-router/use-router.js"],"sourcesContent":["/**\r\n * @return {string} pathname\r\n */\r\nexport function getPathname() {\r\n\treturn location.pathname;\r\n}\r\n/**\r\n * Dispatch history a new pathname\r\n * @type {Redirect}\r\n */\r\nexport function redirect(pathname) {\r\n\tif (pathname == getPathname()) return;\r\n\thistory.pushState({}, \"history\", pathname);\r\n\twindow.dispatchEvent(new PopStateEvent(\"popstate\"));\r\n}\r\n\r\nexport function subscribe(handler) {\r\n\twindow.addEventListener(\"popstate\", handler);\r\n\treturn () => window.removeEventListener(\"popstate\", handler);\r\n}\r\n","const FOLDERS = /([^\\/]+)/g;\r\nconst FOLDER = \"[^\\\\/]\";\r\nconst SPLIT = \"(?:\\\\/){0,1}\";\r\nconst PARAM = /^(:)(\\w+)(\\?|(\\.){3}){0,1}/;\r\nconst PARAMS_EMPTY = {};\r\nconst MEMO = {};\r\n\r\nexport function format(path) {\r\n\treturn path.replace(/(\\/){2,}/g, \"/\").replace(/([^\\/]+)\\/$/, \"$1\");\r\n}\r\n\r\nexport function parse(string) {\r\n\tlet folders = string.match(FOLDERS) || [\"\"];\r\n\tlet params = [];\r\n\tlet regexp = new RegExp(\r\n\t\t\"^\" +\r\n\t\t\tfolders\r\n\t\t\t\t.map(folder => {\r\n\t\t\t\t\tlet [string, param, field, type] =\r\n\t\t\t\t\t\tfolder.match(PARAM) || [];\r\n\t\t\t\t\tif (param) {\r\n\t\t\t\t\t\tparams.push(field);\r\n\t\t\t\t\t\tif (type === \"...\") {\r\n\t\t\t\t\t\t\treturn `(.*)`;\r\n\t\t\t\t\t\t} else if (type === \"?\") {\r\n\t\t\t\t\t\t\treturn `${SPLIT}(${FOLDER}*)`;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treturn `\\\\/(${FOLDER}+)`;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn `\\\\/(?:${folder\r\n\t\t\t\t\t\t\t.replace(/(\\.|\\-)/g, \"\\\\$1\")\r\n\t\t\t\t\t\t\t.replace(/\\*/g, FOLDER + \"+\")\r\n\t\t\t\t\t\t\t.replace(/\\((?!\\?\\:)/g, \"(?:\")})`;\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.join(\"\") +\r\n\t\t\t\"$\",\r\n\t\t\"i\"\r\n\t);\r\n\r\n\treturn { regexp, params, logs: {} };\r\n}\r\n/**\r\n * permite comparar un patron de captura vs un ruta de entrada\r\n * @param {string} path - ruta de patron de captura\r\n * @param {string} value  - ruta de comparacion a patron\r\n * @return {array} - [ inRoute:boolean, params:object ];\r\n */\r\nexport function match(path, value) {\r\n\tpath = format(path);\r\n\tvalue = format(value);\r\n\tif (!MEMO[path]) {\r\n\t\tMEMO[path] = parse(path);\r\n\t}\r\n\tlet { regexp, params, logs } = MEMO[path];\r\n\tif (logs[value]) {\r\n\t\treturn logs[value];\r\n\t}\r\n\tlet vs = value.match(regexp);\r\n\treturn (logs[value] = [\r\n\t\tvs ? true : false,\r\n\t\tvs\r\n\t\t\t? vs.slice(1).reduce((next, value, index) => {\r\n\t\t\t\t\tnext[params[index] || index] = value;\r\n\t\t\t\t\treturn next;\r\n\t\t\t  }, {})\r\n\t\t\t: PARAMS_EMPTY\r\n\t]);\r\n}\r\n","import { useState, useEffect } from \"../core/core\";\r\nimport { redirect, getPathname, subscribe } from \"./location\";\r\nimport { match } from \"./parse\";\r\n\r\nlet cachePathCallback = {};\r\n\r\nexport function useHistory() {\r\n\tlet pathname = getPathname();\r\n\tlet [state, setState] = useState({ pathname });\r\n\r\n\tuseEffect(() => {\r\n\t\tfunction handler() {\r\n\t\t\tlet pathname = getPathname();\r\n\t\t\tif (state.pathname != pathname) {\r\n\t\t\t\tstate.pathname = pathname;\r\n\t\t\t\tsetState(state);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn subscribe(handler);\r\n\t}, []);\r\n\treturn [pathname, redirect];\r\n}\r\n\r\nexport function useMatchRoute(path) {\r\n\treturn match(path, getPathname());\r\n}\r\n\r\nexport function useRoute(path) {\r\n\tuseHistory();\r\n\treturn useMatchRoute(path);\r\n}\r\n\r\nexport function useRedirect(path) {\r\n\treturn (cachePathCallback[path] =\r\n\t\tcachePathCallback[path] || (() => redirect(path)));\r\n}\r\n\r\nexport function useRouter(cases) {\r\n\tlet def = \"default\";\r\n\tlet [pathname] = useHistory();\r\n\tfor (let key in cases) {\r\n\t\tif (key != def) {\r\n\t\t\tlet [status, params] = match(key, pathname);\r\n\t\t\tif (status) return cases[key](params);\r\n\t\t}\r\n\t}\r\n\treturn cases[def];\r\n}\r\n"],"names":[],"mappings":"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"}