var ELEMENT="Atomico",MOUNT="elementMount",UNMOUNT="elementUnmount",UPDATE="elementUpdate",RECEIVE_PROPS="elementReceiveProps";function camelCase(e){return e.replace(/-+([\w])/g,function(e,t){return t.toUpperCase()})}function defer(e){return requestAnimationFrame(e)}function root(e){return e.shadowRoot||e}function remove(e,t){root(e).removeChild(t)}function append(e,t){root(e).appendChild(t)}function replace(e,t,n){root(e).replaceChild(t,n)}function h(e,t){for(var n=[],r=arguments.length-2;r-- >0;)n[r]=arguments[r+2];return new VDom(e,t,concat(n))}function VDom(e,t,n){this.tag=e,this.props=t||{},this.children=n||[]}function isDom(e){return null!==e&&"object"==typeof e&&11!==e.nodeType}function isVDom(e){return"object"==typeof e&&e instanceof VDom}function concat(e,t){void 0===t&&(t=[]);for(var n=0;n<e.length;n++){var r=e[n];Array.isArray(r)?concat(r,t):t.push(isVDom(r)?r:isDom(r)?new VDom(r,{},""):new VDom("",{},r||""))}return t}function diffProps(e,t,n,r,i){for(var s=Object.keys(t).concat(Object.keys(n)),o=0;o<s.length;o++){var a=s[o];if(t[a]!==n[a]){if(i&&e._props.indexOf(a)>-1){i[a]=n[a];continue}if("function"==typeof n[a]||"function"==typeof t[a])t[a]&&e.removeEventListener(a,t[a]),e.addEventListener(a,n[a]);else if(a in n)if(a in e&&!r||r&&"style"===a)if("style"===a)if("object"==typeof n[a])for(var c in n[a])e.style[c]=n[a][c];else e.style.cssText=n[a];else e[a]=n[a];else{if(r&&"xmlns"===a)continue;r?e.setAttributeNS(null,a,n[a]):e.setAttribute(a,n[a])}else e.removeAttribute(a)}}i&&e.setProps(i)}function slot(e,t){return"slot"===e.tag&&(e.tag=t.slots[e.props.name]||""),e}function diff(e,t,n,r,i){void 0===r&&(r=e);for(var s=e.childNodes||[],o=Math.max(t.length,n.length),a=0;a<o;a++){var c=t[a]||new VDom,l=n[a],p=s[a];if(l){l=slot(l,r),c=slot(c,r);var d=p,h=isDom(l.tag);if(i=i||"svg"===l.tag,c.tag!==l.tag)if(h)d=l.tag,p?replace(e,d,p):append(e,d);else if(l.tag)if(d=i?document.createElementNS("http://www.w3.org/2000/svg",l.tag):document.createElement(l.tag),p){if(replace(e,d,p),!d[ELEMENT])for(;p.firstChild;)append(d,p.firstChild)}else append(e,d);else d=document.createTextNode(""),c.tag?replace(e,d,p):append(e,d);h||"#text"!==d.nodeName?(diffProps(d,c.props,l.props,i,d[ELEMENT]&&{children:l.children.map(function(e){return e.tag?e:e.children})}),h||!d||d[ELEMENT]||diff(d,c.children,l.children,r,i)):c.children!==l.children&&(d.textContent=l.children)}else p&&remove(e,p)}}class element extends HTMLElement{constructor(){super(),this[ELEMENT]=!0,this.state={},this.slots={},this.props={},this.fragment=document.createDocumentFragment(),this._props=this.constructor.props||[],this._render=[],this._listener=[],this._mount,this._prevent,this.livecycle()}static get observedAttributes(){return["children"].concat(this.props||[])}livecycle(){var e=this;this.addEventListener(MOUNT,function(t){return e[MOUNT]&&e[MOUNT](t)}),this.addEventListener(UNMOUNT,function(t){return e[UNMOUNT]&&e[UNMOUNT](t)}),this.addEventListener(UPDATE,function(t){return e[UPDATE]&&e[UPDATE](t)}),this.addEventListener(RECEIVE_PROPS,function(t){e[RECEIVE_PROPS]&&e[RECEIVE_PROPS](t),t.defaultPrevented||e.setState({})})}setAttribute(e,t){var n;this._props.indexOf(e)>-1?this.setProps(Object.assign({},this.props,((n={})[e]=t,n))):super.setAttribute(e,t)}connectedCallback(){var e=this;this.props.children=[],defer(function(){for(;e.firstChild;){var t=e.firstChild,n=t.getAttribute&&t.getAttribute("slot");n&&(e.slots[n]=t),append(e.fragment,t),e.props.children.push(t)}e.setState({},e._mount=!0),e.dispatch(MOUNT)})}disconnectedCallback(){this.dispatch(UNMOUNT),this._listener.forEach(function(e){return e()})}setProps(e){var t={};for(var n in e)-1!==this._props.indexOf(n)&&(t[camelCase(n)]=e[n]);this._mount&&this.dispatch(RECEIVE_PROPS,t),this.props=t}attributeChangedCallback(e,t,n){var r;this.setProps(Object.assign({},this.props,((r={})[e]=n,r)))}addEventListener(e,t,n){var r=this;super.addEventListener(e,t,n),this._listener.push(function(){return r.removeEventListener(e,t)})}dispatch(e,t){this.dispatchEvent(new CustomEvent(e,{cancelable:!0,detail:t}))}setState(e,t){var n=this;e&&(this.state=Object.assign({},this.state,e),this._prevent||(this._prevent=!0,defer(function(){var e=concat([n.render()]);diff(root(n),n._render,e),n._render=e,n._prevent=!1,t||n.dispatch(UPDATE)})))}render(){}}export{h,element as Element};
//# sourceMappingURL=atomico.m.js.map
