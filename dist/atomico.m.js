const ELEMENT_PREFIX="element-",ELEMENT_COLLECT="element-collect",ELEMENT_MASTER="element-master";function root(e){return e.shadowRoot||e}function remove(e,t){root(e).removeChild(t)}function append(e,t){root(e).appendChild(t)}function replace(e,t,s){root(e).replaceChild(t,s)}function h(e,t,...s){return new VDom(e,t,concat(s))}class VDom{constructor(e,t,s){this.tag=e,this.props=t||{},this.children=s||[]}clone(e=this.tag,t=this.props,s=this.children){return new VDom(e,Object.assign({},t),s)}}function isDom(e){return null!==e&&"object"==typeof e&&11!==e.nodeType}function isVDom(e){return"object"==typeof e&&e instanceof VDom}function concat(e,t=[]){for(let s=0;s<e.length;s++){let n=e[s];Array.isArray(n)?concat(n,t):t.push(isVDom(n)?n:new VDom("",{},[n||""]))}return t}function diff(e,t,s,n={},o){let r=t&&t[ELEMENT_MASTER]||new VDom,i=t,l=s;if(s){let l="slot"===s.tag;if(s=slot(s,n),r=slot(r,n),o=o||"svg"===s.tag,e&&r.tag!==s.tag)if(i=isDom(s.tag)?s.tag:s.tag?o?document.createElementNS("http://www.w3.org/2000/svg",s.tag):document.createElement(s.tag):document.createTextNode(""),t)for(replace(e,i,t);!l&&!s.collect&&t.firstChild;)append(i,t.firstChild);else append(e,i);if(3===i.nodeType)r.children[0]!==s.children[0]&&(i.textContent=s.children[0]);else{let t=e&&i[ELEMENT_COLLECT]||{},c=diffProps(i,s.tag===r.tag?r.props:{},s.props,o,t.props);if(t.handler)c.children=s.children.map(e=>e.tag?e:e.children[0]),t.handler(c);else if(!l&&i){let e=Array.from((i.shadowRoot||i).childNodes),t=Math.max(e.length,s.children.length);for(let r=0;r<t;r++)diff(i,e[r],s.children[r],n,o)}}}else e&&t&&remove(e,t);return i[ELEMENT_MASTER]=l,i}function Collect(e,t,s){this.observer=e[ELEMENT_COLLECT]={props:t,handler:s}}function diffProps(e,t,s,n,o){let r=Object.keys(t).concat(Object.keys(s)),i=r.length,l={};for(let c=0;c<i;c++){let i=r[c];if((!n||"xmlns"!==i)&&t[i]!==s[i]){if(o&&o.indexOf(i)>-1){l[i]=s[i];continue}let r="function"==typeof s[i],c="function"==typeof t[i];if(r||c)c&&e.removeEventListener(i,t[i]),r&&e.addEventListener(i,s[i]);else if(i in s)if(i in e&&!n||n&&"style"===i)if("style"===i)if("object"==typeof s[i]){let n=t[i]||{},o=s[i];for(let t in o)n[t]!==o[t]&&("-"===t[0]?e.setProperty(t,o[t]):e.style[t]=o[t]);s[i]=Object.assign({},n,o)}else e.style.cssText=s[i];else e[i]=s[i];else n?e.setAttributeNS(null,i,s[i]):e.setAttribute(i,s[i]);else o?s[i]=t[i]:e.removeAttribute(i)}}return l}function slot(e,t){return"slot"===e.tag?(delete(e=e.clone(t[e.props.name]||"")).props.name,e):e}function camelCase(e){return e.replace(/-+([\w])/g,(e,t)=>t.toUpperCase())}function defer(e){return Promise.resolve().then(e)}function getProps(e){let t=Array.isArray(e);return{keys:(t?e:Object.keys(e)).concat("children"),types:t?{}:e}}class Element extends HTMLElement{constructor(){super(),this.props={},this.slots={},this.state={},this.preventRender=!0,this.is=this.nodeName.toLocaleLowerCase(),this._props=getProps(this.constructor.props),new Collect(this,this._props.keys,e=>this.setProperties(e))}get content(){return this.shadowRoot||this}static get props(){return[]}static get observedAttributes(){return getProps(this.props).keys}setAttribute(e,t){this._props.keys.indexOf(e)>-1?this.setProperties({[e]:t}):super.setAttribute(e,t)}setProperties(e){let t={},s=this.isMounted;for(let s in e){let n,o=this._props.types[s],r=e[s];r=o?o(r):r,n=camelCase(s),r!==this.props[n]&&(t[n]=r)}Object.keys(t).length&&(s&&(s=!1!==this.onUpdate(t)),this.props=Object.assign({},this.props,t),s&&this.setState({}))}setState(e,t){"object"==typeof e&&(this.state=Object.assign({},this.state,e),this.preventRender||(this.preventRender=!0,defer(()=>{let e=this.render();diff(!1,this,(e=isVDom(e)&&"host"===e.tag?e:h("host",{},e)).clone(this.is),this.slots),this.preventRender=!1,t?t():this.onUpdated()})))}connectedCallback(){defer(()=>{let e=document.createDocumentFragment();for(;this.firstChild;){let t=this.firstChild,s=t.getAttribute&&t.getAttribute("slot");s&&(this.slots[s]=t),e.appendChild(t)}this.preventRender=!1,this.setState({},()=>{this.isMounted=!0,this.onMounted()})})}disconnectedCallback(){this.onUnmounted()}attributeChangedCallback(e,t,s){t!==s&&this.setProperties({[e]:s})}onMounted(){}onUpdate(){}onUnmounted(){}onUpdated(){}render(){}}export{Element,h};
//# sourceMappingURL=atomico.m.js.map
