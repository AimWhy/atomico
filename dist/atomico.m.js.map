{"version":3,"file":"atomico.m.js","sources":["../src/vdom/dom.js","../src/vdom/vdom.js","../src/vdom/diff.js","../src/utils.js","../src/component.js"],"sourcesContent":["export function root(parent) {\r\n    return parent.shadowRoot || parent;\r\n}\r\nexport function remove(parent, child) {\r\n    root(parent).removeChild(child);\r\n}\r\n\r\nexport function append(parent, child) {\r\n    root(parent).appendChild(child);\r\n}\r\n\r\nexport function replace(parent, newChild, oldChild) {\r\n    root(parent).replaceChild(newChild, oldChild);\r\n}\r\n","/**\r\n * Create an instance of a virtual node\r\n * @param {*} tag - be social to the tagName\r\n * @param {*} props - is associated with the attributes of the tag\r\n * @param  {...*} children - the children associated with the tag\r\n * @return {VDom}\r\n */\r\nexport function h(tag, props, ...children) {\r\n    return new VDom(tag, props, concat(children));\r\n}\r\n/**\r\n * Create an instance of a virtual node\r\n * @param {*} tag - be social to the tagName\r\n * @param {*} props - is associated with the attributes of the tag\r\n * @param  {...*} children - the children associated with the tag\r\n */\r\nexport function VDom(tag, props, children) {\r\n    this.tag = tag;\r\n    this.props = props || {};\r\n    this.children = children || [];\r\n}\r\n/**\r\n *\r\n * @param {*} value\r\n * @return {Boolean}\r\n */\r\nexport function isVDom(value) {\r\n    return typeof value === \"object\" && value instanceof VDom;\r\n}\r\n/**\r\n * prepares the children associated with virtual dom, managing to simplify the algorithm of diff\r\n * @param {*} children - list of children associated with the virtual dom\r\n * @param {*} merge - array that concatenates all the children independent of the depth of the array\r\n * @return {Array}\r\n */\r\nexport function concat(children, merge = []) {\r\n    for (let i = 0; i < children.length; i++) {\r\n        let child = children[i];\r\n        Array.isArray(child)\r\n            ? concat(child, merge)\r\n            : merge.push(isVDom(child) ? child : new VDom(\"\", {}, child || \"\"));\r\n    }\r\n    return merge;\r\n}\r\n","import { remove, append, replace, root } from \"./dom\";\r\nimport { VDom, h } from \"./vdom\";\r\n/**\r\n * compares the attributes associated with the 2 render states\r\n * @param {HTMLELement} node\r\n * @param {Object} prev\r\n * @param {Object} next\r\n * @param {Boolean} svg\r\n */\r\nexport function diffProps(node, prev, next, svg) {\r\n    // generates a list of the existing attributes in both versions\r\n    let keys = Object.keys(prev).concat(Object.keys(next));\r\n    for (let i = 0; i < keys.length; i++) {\r\n        let prop = keys[i];\r\n        if (prev[prop] !== next[prop]) {\r\n            if (\r\n                typeof next[prop] === \"function\" ||\r\n                typeof prev[prop] === \"function\"\r\n            ) {\r\n                node[prop.toLowerCase()] = next[prop] || null;\r\n            } else if (prop in next) {\r\n                if ((prop in node && !svg) || (svg && prop === \"style\")) {\r\n                    if (prop === \"style\") {\r\n                        if (typeof next[prop] === \"object\") {\r\n                            for (let index in next[prop]) {\r\n                                node.style[index] = next[prop][index];\r\n                            }\r\n                        } else {\r\n                            node.style.cssText = next[prop];\r\n                        }\r\n                    } else {\r\n                        node[prop] = next[prop];\r\n                    }\r\n                } else {\r\n                    svg\r\n                        ? node.setAttributeNS(null, prop, next[prop])\r\n                        : node.setAttribute(prop, next[prop]);\r\n                }\r\n            } else {\r\n                node.removeAttribute(prop);\r\n            }\r\n        }\r\n    }\r\n}\r\n/**\r\n * It allows to compare the 2 states of the render\r\n * @param {HTMLELement} parent - will receive the changes that the diff process determines\r\n * @param {Array} master - Previous state of the render\r\n * @param {Array} commit - Next render state\r\n * @param {Boolean} svg\r\n */\r\nexport function diff(parent, master, commit, svg) {\r\n    let children = parent.childNodes || [],\r\n        length = Math.max(master.length, commit.length);\r\n    for (let i = 0; i < length; i++) {\r\n        let prev = master[i] || new VDom(),\r\n            next = commit[i],\r\n            node = children[i];\r\n\r\n        if (next) {\r\n            let cursor = node;\r\n            svg = svg || next.tag === \"svg\";\r\n            if (prev.tag !== next.tag) {\r\n                if (next.tag) {\r\n                    cursor = svg\r\n                        ? document.createElementNS(\r\n                              \"http://www.w3.org/2000/svg\",\r\n                              next.tag\r\n                          )\r\n                        : document.createElement(next.tag);\r\n                    if (node) {\r\n                        replace(parent, cursor, node);\r\n                        // Avoid the merge if the node is a component\r\n                        if (!cursor.dispatch) {\r\n                            while (node.firstChild) {\r\n                                append(cursor, node.firstChild);\r\n                            }\r\n                        }\r\n                    } else {\r\n                        append(parent, cursor);\r\n                    }\r\n                } else {\r\n                    cursor = document.createTextNode(\"\");\r\n                    if (prev.tag) {\r\n                        replace(parent, cursor, node);\r\n                    } else {\r\n                        append(parent, cursor);\r\n                    }\r\n                }\r\n            }\r\n            if (cursor.nodeName === \"#text\") {\r\n                if (prev.children !== next.children)\r\n                    cursor.textContent = next.children;\r\n            } else {\r\n                // transmits the children to the component\r\n                if (cursor.dispatch) {\r\n                    cursor.dispatch(\"receiveChildren\", next.children);\r\n                }\r\n                diffProps(cursor, prev.props, next.props, svg);\r\n                if (cursor && !cursor.render) {\r\n                    diff(cursor, prev.children, next.children, svg);\r\n                }\r\n            }\r\n        } else {\r\n            if (node) remove(parent, node);\r\n        }\r\n    }\r\n}\r\n","export function getMethods(proto) {\r\n    let keys = [];\r\n    do {\r\n        keys = keys.concat(Object.getOwnPropertyNames(proto));\r\n    } while ((proto = Object.getPrototypeOf(proto)));\r\n    return keys;\r\n}\r\n\r\nexport function getEvents(Root) {\r\n    let regExp = /^on([A-Z])/,\r\n        methods = getMethods(Root.prototype),\r\n        events = [];\r\n    for (let i = 0; i < methods.length; i++) {\r\n        let method = methods[i];\r\n        if (methods.indexOf(method) === i && regExp.test(method)) {\r\n            events.push({\r\n                method,\r\n                type: method.replace(regExp, (all, letter) =>\r\n                    letter.toLowerCase()\r\n                )\r\n            });\r\n        }\r\n    }\r\n    return events;\r\n}\r\n\r\nexport function getProps(props, element) {\r\n    let data = {};\r\n    for (let i = 0; i < props.length; i++) {\r\n        let prop = props[i],\r\n            value =\r\n                element instanceof HTMLElement\r\n                    ? element.getAttribute(prop)\r\n                    : element[prop];\r\n\r\n        data[\r\n            prop.replace(/-+([\\w])/g, (all, letter) => letter.toUpperCase())\r\n        ] = /^json-/.test(prop) ? JSON.parse(value) : value;\r\n    }\r\n    return data;\r\n}\r\n","import { root } from \"./vdom/dom\";\r\nimport { diff } from \"./vdom/diff\";\r\nimport { concat } from \"./vdom/vdom\";\r\nimport { getProps } from \"./utils\";\r\nexport default class extends HTMLElement {\r\n    constructor() {\r\n        super();\r\n        this.autorun();\r\n    }\r\n    static get observedAttributes() {\r\n        return this.props || [];\r\n    }\r\n    autorun() {\r\n        this.state = {};\r\n        this.props = { children: [] };\r\n        this._props = this.constructor.props || [];\r\n        this._render = [];\r\n\r\n        let block = true;\r\n        [\"create\", \"mount\", \"unmount\", \"receiveProp\", \"receiveChildren\"].map(\r\n            type => {\r\n                let method = type.replace(\r\n                    /\\w/,\r\n                    letter => \"on\" + letter.toUpperCase()\r\n                );\r\n                this.addEventListener(type, event => {\r\n                    if (event.type !== type) return;\r\n\r\n                    if (type === \"mount\") {\r\n                        this.props = getProps(this._props, this);\r\n                        block = false;\r\n                    }\r\n                    if (block) return;\r\n                    if (this[method]) this[method](event);\r\n\r\n                    if (event.defaultPrevented) return;\r\n                    if (type === \"receiveProp\") {\r\n                        this.props = { ...this.props, ...event.detail };\r\n                    }\r\n                    if (type === \"receiveChildren\") {\r\n                        this.props.children = event.detail;\r\n                    }\r\n                    this.setState({});\r\n                });\r\n            }\r\n        );\r\n    }\r\n    connectedCallback() {\r\n        this.dispatch(\"mount\");\r\n    }\r\n    disconnectedCallback() {\r\n        this.dispatch(\"unmount\");\r\n    }\r\n    attributeChangedCallback(index, prev, next) {\r\n        if (prev === next) return;\r\n        this.dispatch(\"receiveProp\", getProps([index], { [index]: next }));\r\n    }\r\n    dispatch(type, detail) {\r\n        this.dispatchEvent(\r\n            new CustomEvent(type, {\r\n                cancelable: true,\r\n                detail\r\n            })\r\n        );\r\n    }\r\n    setState(next) {\r\n        if (!next) return;\r\n        this.state = { ...this.state, ...next };\r\n        let render = concat([this.render()]);\r\n        diff(root(this), this._render, render);\r\n        this._render = render;\r\n    }\r\n    render() {}\r\n}\r\n"],"names":["root","parent","shadowRoot","remove","child","removeChild","append","appendChild","replace","newChild","oldChild","replaceChild","h","tag","props","VDom","concat","children","this","isVDom","value","merge","let","i","length","Array","isArray","push","diffProps","node","prev","next","svg","keys","Object","prop","toLowerCase","index","style","cssText","setAttributeNS","setAttribute","removeAttribute","diff","master","commit","childNodes","Math","max","cursor","document","createElementNS","createElement","dispatch","firstChild","createTextNode","nodeName","textContent","render","getProps","element","data","HTMLElement","getAttribute","all","letter","toUpperCase","test","JSON","parse","[object Object]","super","autorun","observedAttributes","state","_props","constructor","_render","block","map","type","method","addEventListener","event","defaultPrevented","detail","setState","dispatchEvent","CustomEvent","cancelable"],"mappings":"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"}