"use strict";function h(e,t){for(var r=[],n=arguments.length-2;n-- >0;)r[n]=arguments[n+2];return new VDom(e,t,concat(r))}function VDom(e,t,r){this.tag=e,this.props=t||{},this.children=r||[]}function isDom(e){return null!==e&&"object"==typeof e&&11!==e.nodeType}function isVDom(e){return"object"==typeof e&&e instanceof VDom}function concat(e,t){void 0===t&&(t=[]);for(var r=0;r<e.length;r++){var n=e[r];Array.isArray(n)?concat(n,t):t.push(isVDom(n)?n:isDom(n)?new VDom(n,{},[""]):new VDom("",{},[n||""]))}return t}Object.defineProperty(exports,"__esModule",{value:!0});var ELEMENT="__atomico_el__",MASTER="__atomico_prev__";function camelCase(e){return e.replace(/-+([\w])/g,function(e,t){return t.toUpperCase()})}function defer(e){return Promise.resolve().then(e)}function root(e){return e.shadowRoot||e}function remove(e,t){root(e).removeChild(t)}function append(e,t){root(e).appendChild(t)}function replace(e,t,r){root(e).replaceChild(t,r)}function getProps(e){var t=Array.isArray(e);return{keys:(t?e:Object.keys(e)).concat("children"),types:t?{}:e}}function diffProps(e,t,r,n,s,o){for(var i=Object.keys(t).concat(Object.keys(r)),a=i.length,c={},l=0;l<a;l++){var p=i[l];if(t[p]!==r[p]){if(s&&s.indexOf(p)>-1){c[p]=r[p];continue}if("function"==typeof r[p]||"function"==typeof t[p])t[p]&&e.removeEventListener(p,t[p]),e.addEventListener(p,r[p]);else if(p in r)if(p in e&&!n||n&&"style"===p)if("style"===p)if("object"==typeof r[p]){var f=t[p]||{},h=r[p];for(var u in h)f[u]!==h[u]&&(e.style[u]=h[u]);r[p]=Object.assign({},f,h)}else e.style.cssText=r[p];else e[p]=r[p];else{if(n&&"xmlns"===p)continue;n?e.setAttributeNS(null,p,r[p]):e.setAttribute(p,r[p])}else o?r[p]=t[p]:e.removeAttribute(p)}}return c}function slot(e,t){return"slot"===e.tag?new VDom(t[e.props.name]||"",e.props,e.children):e}function diff(e,t,r,n,s){void 0===n&&(n={});var o=t&&t[MASTER]?t[MASTER]:new VDom,i=t,a=r;if(r){if(r=slot(r,n),o=slot(o,n),s=s||"svg"===r.tag,e&&o.tag!==r.tag)if(i=isDom(r.tag)?r.tag:r.tag?s?document.createElementNS("http://www.w3.org/2000/svg",r.tag):document.createElement(r.tag):document.createTextNode(""),t)for(replace(e,i,t);!i[ELEMENT]&&t.firstChild;)append(i,t.firstChild);else append(e,i);if(3===i.nodeType)o.children[0]!==r.children[0]&&(i.textContent=r.children[0]);else{var c=e&&i[ELEMENT]&&i._props.keys,l=diffProps(i,o.props,r.props,s,c,c);if(i[ELEMENT]&&e)l.children=r.children.map(function(e){return e.tag?e:e.children}),i.setProperties(l);else if(i)for(var p=Array.from(i.childNodes),f=Math.max(p.length,r.children.length),h=0;h<f;h++)diff(i,p[h],r.children[h],n,s)}}else e&&t&&remove(e,t);return i[MASTER]=a,e}class element extends HTMLElement{constructor(){super(),this[ELEMENT]=!0,this.slots={},this.props={children:[]},this.isMount=!1,this.preventRender=!0,this.content=document.createDocumentFragment(),this._class=this.constructor,this._name=this.tagName.toLocaleLowerCase(),this._props=getProps(this._class.props)}static get props(){return{}}static get observedAttributes(){return getProps(this.props).keys}connectedCallback(){var e=this;defer(function(){for(;e.firstChild;){var t=e.firstChild,r=t.getAttribute&&t.getAttribute("slot");r&&(e.slots[r]=t),append(e.content,t)}e.preventRender=!1,e.setState({},function(){e.isMount=!0,e.elementMount()})})}setAttribute(e,t){var r;this._props.keys.indexOf(e)>-1?this.setProperties(((r={})[e]=t,r)):super.setAttribute(e,t)}setProperties(e){var t={},r=this.isMount;for(var n in e){var s,o=this._props.types[n],i=e[n];o&&(i=o(i)),s=camelCase(n),i!==this.props[s]&&(t[s]=i)}Object.keys(t).length&&(r&&(r=!1!==this.elementReceiveProps(t)),this.props=Object.assign({},this.props,t),r&&this.setState({}))}attributeChangedCallback(e,t,r){var n;this.setProperties(((n={})[e]=r,n))}disconnectedCallback(){this.elementMount()}setState(e,t){var r=this;"object"==typeof e&&(this.state=Object.assign({},this.state,e),this.preventRender||(this.preventRender=!0,defer(function(){var e=r.render();if(isVDom(e)){var n="host"===e.tag;e=h(r._name,n?e.props:{},n?e.children:e)}else e=h(r._name,{},e);diff(!1,r,e,r.slots),r.preventRender=!1,t?t():r.elementUpdate()})))}elementMount(){}elementUnmount(){}elementUpdate(){}elementReceiveProps(){}render(){}}exports.h=h,exports.Element=element;
//# sourceMappingURL=atomico.js.map
