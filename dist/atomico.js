"use strict";function getMethods(e){var t=[];do{t=t.concat(Object.getOwnPropertyNames(e))}while(e=Object.getPrototypeOf(e));return t}function getEvents(e){for(var t=/^on([A-Z])/,n=getMethods(e.prototype),r=[],o=0;o<n.length;o++){var s=n[o];n.indexOf(s)===o&&t.test(s)&&r.push({method:s,type:s.replace(t,function(e,t){return t.toLowerCase()})})}return r}function getProps(e,t){for(var n={},r=0;r<e.length;r++){var o=e[r],s=t instanceof HTMLElement?t.getAttribute(o):t[o];n[o.replace(/-+([\w])/g,function(e,t){return t.toUpperCase()})]=/^json-/.test(o)?JSON.parse(s):s}return n}function remove(e,t){e.removeChild(t)}function append(e,t){e.appendChild(t)}function replace(e,t,n){e.replaceChild(t,n)}function createText(){return document.createTextNode("")}function createElement(e,t){return t?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e)}function h(e,t){for(var n=[],r=arguments.length-2;r-- >0;)n[r]=arguments[r+2];return new VDom(e,t,concat(n))}function VDom(e,t,n){this.tag=e,this.props=t||{},this.children=n||[]}function isVDom(e){return"object"==typeof e&&e instanceof VDom}function concat(e,t){void 0===t&&(t=[]);for(var n=0;n<e.length;n++){var r=e[n];Array.isArray(r)?concat(r,t):t.push(isVDom(r)?r:new VDom("",{},r||""))}return t}function diffProps(e,t,n,r){for(var o=Object.keys(t).concat(Object.keys(n)),s=0;s<o.length;s++){var i=o[s];if(t[i]!==n[i])if("function"==typeof n[i]||"function"==typeof t[i])e[i.toLowerCase()]=n[i]||null;else if(i in n)if(i in e&&!r||r&&"style"===i)if("style"===i)if("object"==typeof n[i])for(var a in n[i])e.style[a]=n[i][a];else e.style.cssText=n[i];else e[i]=n[i];else r?e.setAttributeNS(null,i,n[i]):e.setAttribute(i,n[i]);else e.removeAttribute(i)}}function diff(e,t,n,r){for(var o=e.childNodes||[],s=Math.max(t.length,n.length),i=0;i<s;i++){var a=t[i]||new VDom,c=n[i],p=o[i];if(c){var u=p;if(r=r||"svg"===c.tag,a.tag!==c.tag)if(c.tag)if(u=createElement(c.tag,r),p)for(replace(e,u,p);p.firstChild;)u.appendChild(p.firstChild);else append(e,u);else u=createText(),a.tag?replace(e,u,p):append(e,u);"#text"===u.nodeName?a.children!==c.children&&(u.textContent=c.children):(diffProps(u,a.props,c.props,r),u&&diff(u,a.children,c.children,r))}else p&&remove(e,p)}}Object.defineProperty(exports,"__esModule",{value:!0});class Component{constructor(e){var t=this;this.root=e,this.props={},this.state={};var n=[];this.setState=function(e){void 0===e&&(e={}),t.state=Object.assign({},t.state,e);var r=concat([t.render()]);diff(t.root,n,r),n=r}}onMount(){}onUpdate(){}onUnmount(){}onRender(e){this.setState()}render(){}}function register(e,t){var n=t.props||[],r=getEvents(t);customElements.define(e,class extends HTMLElement{constructor(){super(),this.autorun(),this.root=new t(this)}static get observedAttributes(){return n}autorun(){var e=this;r.forEach(function(t){var n=t.type,r=t.method;e.addEventListener(n,function(t){e.root[r](t),t.defaultPrevented||("update"===n&&(e.root.props=Object.assign({},e.root.props,t.detail)),/^(render|unmount)$/.test(n)||e.dispatch("render"))},!0)})}connectedCallback(){this.dispatch("mount")}disconnectedCallback(){this.dispatch("unmount")}attributeChangedCallback(e,t,r){var o;this.dispatch("update",getProps(n,((o={})[e]=r,o)))}dispatch(e,t){this.dispatchEvent(new CustomEvent(e,{cancelable:!0,detail:t}))}})}exports.h=h,exports.Component=Component,exports.register=register;
//# sourceMappingURL=atomico.js.map
