"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ELEMENT="Atomico",MOUNT="elementMount",UNMOUNT="elementUnmount",RECEIVE_PROPS="elementReceiveProps";function getProps(e,t){for(var n={},r=0;r<e.length;r++){var i=e[r],s=t instanceof HTMLElement?t.getAttribute(i):t[i];n[i.replace(/-+([\w])/g,function(e,t){return t.toUpperCase()})]=/^json-/.test(i)?JSON.parse(s):s}return n}function root(e){return e.shadowRoot||e}function remove(e,t){root(e).removeChild(t)}function append(e,t){root(e).appendChild(t)}function replace(e,t,n){root(e).replaceChild(t,n)}function h(e,t){for(var n=[],r=arguments.length-2;r-- >0;)n[r]=arguments[r+2];return new VDom(e,t,concat(n))}function VDom(e,t,n){this.tag=e,this.props=t||{},this.children=n||[]}function isVDom(e){return"object"==typeof e&&e instanceof VDom}function concat(e,t){void 0===t&&(t=[]);for(var n=0;n<e.length;n++){var r=e[n];Array.isArray(r)?concat(r,t):t.push(isVDom(r)?r:new VDom("",{},r||""))}return t}function diffProps(e,t,n,r,i){for(var s=Object.keys(t).concat(Object.keys(n)),o=0;o<s.length;o++){var a=s[o];if(t[a]!==n[a]){if(i&&e._props.indexOf(a)>-1){i[a]=n[a];continue}if("function"==typeof n[a]||"function"==typeof t[a])t[a]&&e.removeEventListener(a,t[a]),e.addEventListener(a,n[a]);else if(a in n)if(a in e&&!r||r&&"style"===a)if("style"===a)if("object"==typeof n[a])for(var c in n[a])e.style[c]=n[a][c];else e.style.cssText=n[a];else e[a]=n[a];else r?e.setAttributeNS(null,a,n[a]):e.setAttribute(a,n[a]);else e.removeAttribute(a)}}i&&e.dispatch(RECEIVE_PROPS,i)}function diff(e,t,n,r){for(var i=e.childNodes||[],s=Math.max(t.length,n.length),o=0;o<s;o++){var a=t[o]||new VDom,c=n[o],p=i[o];if(c){var l=p;if(r=r||"svg"===c.tag,a.tag!==c.tag)if(c.tag)if(l=r?document.createElementNS("http://www.w3.org/2000/svg",c.tag):document.createElement(c.tag),p){if(replace(e,l,p),!l[ELEMENT])for(;p.firstChild;)append(l,p.firstChild)}else append(e,l);else l=document.createTextNode(""),a.tag?replace(e,l,p):append(e,l);"#text"===l.nodeName?a.children!==c.children&&(l.textContent=c.children):(diffProps(l,a.props,c.props,r,l[ELEMENT]&&{children:c.children.map(function(e){return e.children})}),l&&!l[ELEMENT]&&diff(l,a.children,c.children,r))}else p&&remove(e,p)}}class element extends HTMLElement{constructor(){super(),this.autorun()}static get observedAttributes(){return this.props||[]}autorun(){var e=this;this[ELEMENT]=!0,this.state={},this.props={children:[]},this._props=this.constructor.props||[],this._render=[];var t=!0;this.listeners=[MOUNT,UNMOUNT,RECEIVE_PROPS].map(function(n){var r=function(r){r.type===n&&(n===MOUNT&&(e.props=Object.assign({},getProps(e._props,e)),t=!1),t||(e[n]&&e[n](r),r.defaultPrevented||(n===RECEIVE_PROPS&&(e.props=Object.assign({},e.props,r.detail)),e.setState({}))))};return e.addEventListener(n,r),function(){return e.removeEventListener(n,r)}})}connectedCallback(){this.dispatch(MOUNT)}disconnectedCallback(){this.dispatch(UNMOUNT),this.listeners.forEach(function(e){return e()})}attributeChangedCallback(e,t,n){var r;t!==n&&this.dispatch(RECEIVE_PROPS,getProps([e],((r={})[e]=n,r)))}dispatch(e,t){this.dispatchEvent(new CustomEvent(e,{cancelable:!0,detail:t}))}setState(e){if(e){this.state=Object.assign({},this.state,e);var t=concat([this.render()]);diff(root(this),this._render,t),this._render=t}}render(){}}exports.h=h,exports.Element=element;
//# sourceMappingURL=atomico.js.map
