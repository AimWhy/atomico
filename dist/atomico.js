"use strict";function h(e,t){for(var r=[],n=arguments.length-2;n-- >0;)r[n]=arguments[n+2];return new VDom(e,t,concat(r))}function VDom(e,t,r){this.tag=e,this.props=t||{},this.children=r||[]}function isDom(e){return null!==e&&"object"==typeof e&&11!==e.nodeType}function isVDom(e){return"object"==typeof e&&e instanceof VDom}function concat(e,t){void 0===t&&(t=[]);for(var r=0;r<e.length;r++){var n=e[r];Array.isArray(n)?concat(n,t):t.push(isVDom(n)?n:isDom(n)?new VDom(n,{},""):new VDom("",{},n||""))}return t}Object.defineProperty(exports,"__esModule",{value:!0});var ELEMENT="__atomico_el__",MASTER="__atomico_prev__";function camelCase(e){return e.replace(/-+([\w])/g,function(e,t){return t.toUpperCase()})}function defer(e){return Promise.resolve().then(e)}function root(e){return e.shadowRoot||e}function remove(e,t){root(e).removeChild(t)}function append(e,t){root(e).appendChild(t)}function replace(e,t,r){root(e).replaceChild(t,r)}function diffProps(e,t,r,n,s){for(var o=Object.keys(t).concat(Object.keys(r)),i={},c=0;c<o.length;c++){var a=o[c];if(t[a]!==r[a]){if(s&&s.indexOf(a)>-1){i[a]=r[a];continue}if("function"==typeof r[a]||"function"==typeof t[a])t[a]&&e.removeEventListener(a,t[a]),e.addEventListener(a,r[a]);else if(a in r)if(a in e&&!n||n&&"style"===a)if("style"===a)if("object"==typeof r[a])for(var l in r[a])e.style[l]=r[a][l];else e.style.cssText=r[a];else e[a]=r[a];else{if(n&&"xmlns"===a)continue;n?e.setAttributeNS(null,a,r[a]):e.setAttribute(a,r[a])}else e.removeAttribute(a)}}return i}function slot(e,t){return"slot"===e.tag?new VDom(t[e.props.name]||"",e.props,e.children):e}function diff(e,t,r,n,s){void 0===n&&(n={});var o,i=t&&t[MASTER]?t[MASTER]:new VDom,c=t,a=r;if(r){if(r=slot(r,n),i=slot(i,n),s=s||"svg"===r.tag,o=isDom(r.tag),e&&i.tag!==r.tag)if(o)c=r.tag,t?replace(e,c,t):append(e,c);else if(r.tag)if(c=s?document.createElementNS("http://www.w3.org/2000/svg",r.tag):document.createElement(r.tag),t){if(replace(e,c,t),!c[ELEMENT])for(;t.firstChild;)append(c,t.firstChild)}else append(e,c);else c=document.createTextNode(""),i.tag?replace(e,c,t):append(e,c);if(3===c.nodeType)i.children!==r.children&&(c.textContent=r.children);else{var l=c[Element],p=diffProps(c,i.props,r.props,s,l&&c._props.keys);if(l)p.children=r.children.map(function(e){return e.tag?e:e.children}),this.setProperties(p);else if(c)for(var f=Array.from(c.childNodes),h=Math.max(f.length,r.children.length),u=0;u<h;u++)diff(c,f[u],r.children[u],n,s)}c[MASTER]=a}else e&&t&&remove(e,t);return e}class element extends HTMLElement{constructor(){super(),this[ELEMENT]=!0,this.slots={},this.props={},this.preventRender=!0,this.content=document.createDocumentFragment(),this.class=this.constructor,this._props={keys:this.class.observedAttributes,types:this.class.props}}static get props(){return{}}static get observedAttributes(){return Object.keys(this.props).concat("children")}get isMount(){return this[MASTER]}connectedCallback(){var e=this;defer(function(){for(var t=[];e.firstChild;){var r=e.firstChild,n=r.getAttribute&&r.getAttribute("slot");n&&(e.slots[n]=r),append(e.content,r),t.push(r)}e.setProperties({children:t}),e.preventRender=!1,e.setState({})})}setAttribute(e,t){var r;this._props.keys.indexOf(e)>-1?this.setProperties(((r={})[e]=t,r)):super.setAttribute(e,t)}setProperties(e){var t={},r=this.isMount;for(var n in e){var s,o=this._props.types[n],i=e[n];o&&(i=o(i)),s=camelCase(n),i!==this.props[s]&&(t[s]=i)}Object.keys(t).length&&(r&&(r=!1!==this.elementReceiveProps(t)),this.props=Object.assign({},this.props,t),r&&this.setState({}))}attributeChangedCallback(e,t,r){var n;this.setProperties(((n={})[e]=r,n))}disconnectedCallback(){this.elementMount()}setState(e){var t=this;"object"==typeof e&&(this.state=Object.assign({},this.state,e),this.preventRender||(this.preventRender=!0,defer(function(){var e=t.render(),r=t.isMount;e=isVDom(e)&&"host"===e.tag?e:h("host",null,e),diff(!1,t,e,t.slots),t.preventRender=!1,r?t.elementUpdate():t.elementMount()})))}elementMount(){}elementUnmount(){}elementUpdate(){}elementReceiveProps(){}render(){}}exports.h=h,exports.Element=element;
//# sourceMappingURL=atomico.js.map
